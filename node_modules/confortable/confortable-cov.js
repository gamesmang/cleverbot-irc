
// instrument by jscoverage, do not modifly this file
(function (file, lines, conds, source) {
  var BASE;
  if (typeof global === 'object') {
    BASE = global;
  } else if (typeof window === 'object') {
    BASE = window;
  } else {
    throw new Error('[jscoverage] unknow ENV!');
  }
  if (BASE._$jscoverage) {
    BASE._$jscmd(file, 'init', lines, conds, source);
    return;
  }
  var cov = {};
  /**
   * jsc(file, 'init', lines, condtions)
   * jsc(file, 'line', lineNum)
   * jsc(file, 'cond', lineNum, expr, start, offset)
   */
  function jscmd(file, type, line, express, start, offset) {
    var storage;
    switch (type) {
      case 'init':
        if(cov[file]){
          storage = cov[file];
        } else {
          storage = [];
          for (var i = 0; i < line.length; i ++) {
            storage[line[i]] = 0;
          }
          var condition = express;
          var source = start;
          storage.condition = condition;
          storage.source = source;
        }
        cov[file] = storage;
        break;
      case 'line':
        storage = cov[file];
        storage[line] ++;
        break;
      case 'cond':
        storage = cov[file];
        storage.condition[line] ++;
        return express;
    }
  }

  BASE._$jscoverage = cov;
  BASE._$jscmd = jscmd;
  jscmd(file, 'init', lines, conds, source);
})('confortable.js', [1,4,43,5,6,10,11,7,17,26,21,24,31,33,38,44,48,46,50], {"5_13_16":0,"5_33_44":0,"10_10_5":0,"10_19_13":0,"15_6_21":0,"15_6_10":0,"15_20_7":0,"20_8_16":0,"23_8_15":0,"32_8_15":0,"37_8_44":0,"45_6_22":0,"45_6_6":0,"45_16_12":0,"49_6_14":0}, ["var exists = require('fs').existsSync","  , path = require('path');","","var findFromStart = function (name, start) {","  var HOME = process.env.HOME || process.env.HOMEDRIVE + process.env.HOMEPATH;","  var withinHome = function (dir) {","    return (path.relative(HOME, dir).slice(0, 2) !== '..');","  };","","  start = start || process.cwd();","  var relative = path.relative(HOME, start)","    , noRelation = (relative === start) // i.e. different drive or undefined HOME","    , isAbove = (relative.slice(0, 2) === '..');","","  if (noRelation || isAbove) {","    // start is outside HOME: check start and HOME only","    var startCfg = path.join(start, name)","      , homeCfg = path.join(HOME, name);","","    if (exists(startCfg)) {","      return startCfg;","    }","    if (exists(homeCfg)) {","      return homeCfg;","    }","    return;","  }","","  // start is under HOME, move up the directory tree until we hit HOME","  for (var dir = start; withinHome(dir) ; dir = path.join(dir, '..')) {","    var currCfg = path.join(dir, name);","    if (exists(currCfg)) {","      return currCfg;","    }","","    // windows $HOME defined at drive root => joining on '..' does nothing","    if (path.join(dir, '..') === path.normalize(dir)) {","      return; // at windows root, we found nothing. dont loop forever","    }","  }","};","","module.exports = function (name, start, fallbackDir) {","  var result = findFromStart(name, start);","  if (result || !fallbackDir) {","    return result;","  }","  var fbPath = path.join(fallbackDir, name);","  if (exists(fbPath)) {","    return fbPath;","  }","};",""]);
_$jscmd("confortable.js", "line", 1);

var exists = require("fs").existsSync, path = require("path");

_$jscmd("confortable.js", "line", 4);

var findFromStart = function(name, start) {
    _$jscmd("confortable.js", "line", 5);
    var HOME = _$jscmd("confortable.js", "cond", "5_13_16", process.env.HOME) || _$jscmd("confortable.js", "cond", "5_33_44", process.env.HOMEDRIVE + process.env.HOMEPATH);
    _$jscmd("confortable.js", "line", 6);
    var withinHome = function(dir) {
        _$jscmd("confortable.js", "line", 7);
        return path.relative(HOME, dir).slice(0, 2) !== "..";
    };
    _$jscmd("confortable.js", "line", 10);
    start = _$jscmd("confortable.js", "cond", "10_10_5", start) || _$jscmd("confortable.js", "cond", "10_19_13", process.cwd());
    _$jscmd("confortable.js", "line", 11);
    var relative = path.relative(HOME, start), noRelation = relative === start, isAbove = relative.slice(0, 2) === "..";
    if (_$jscmd("confortable.js", "cond", "15_6_21", _$jscmd("confortable.js", "cond", "15_6_10", noRelation) || _$jscmd("confortable.js", "cond", "15_20_7", isAbove))) {
        _$jscmd("confortable.js", "line", 17);
        // start is outside HOME: check start and HOME only
        var startCfg = path.join(start, name), homeCfg = path.join(HOME, name);
        if (_$jscmd("confortable.js", "cond", "20_8_16", exists(startCfg))) {
            _$jscmd("confortable.js", "line", 21);
            return startCfg;
        }
        if (_$jscmd("confortable.js", "cond", "23_8_15", exists(homeCfg))) {
            _$jscmd("confortable.js", "line", 24);
            return homeCfg;
        }
        _$jscmd("confortable.js", "line", 26);
        return;
    }
    // start is under HOME, move up the directory tree until we hit HOME
    for (var dir = start; withinHome(dir); dir = path.join(dir, "..")) {
        _$jscmd("confortable.js", "line", 31);
        var currCfg = path.join(dir, name);
        if (_$jscmd("confortable.js", "cond", "32_8_15", exists(currCfg))) {
            _$jscmd("confortable.js", "line", 33);
            return currCfg;
        }
        // windows $HOME defined at drive root => joining on '..' does nothing
        if (_$jscmd("confortable.js", "cond", "37_8_44", path.join(dir, "..") === path.normalize(dir))) {
            _$jscmd("confortable.js", "line", 38);
            return;
        }
    }
};

_$jscmd("confortable.js", "line", 43);

module.exports = function(name, start, fallbackDir) {
    _$jscmd("confortable.js", "line", 44);
    var result = findFromStart(name, start);
    if (_$jscmd("confortable.js", "cond", "45_6_22", _$jscmd("confortable.js", "cond", "45_6_6", result) || _$jscmd("confortable.js", "cond", "45_16_12", !fallbackDir))) {
        _$jscmd("confortable.js", "line", 46);
        return result;
    }
    _$jscmd("confortable.js", "line", 48);
    var fbPath = path.join(fallbackDir, name);
    if (_$jscmd("confortable.js", "cond", "49_6_14", exists(fbPath))) {
        _$jscmd("confortable.js", "line", 50);
        return fbPath;
    }
};